<!DOCTYPE html>
<html>
<head>
    <title>照片分享</title>
    <style>
        body {
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            padding: 20px 0;
            color: #333;
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .image-container {
            text-align: center;
            margin: 20px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
            border-radius: 4px;
            overflow: hidden;
        }

        .image-container:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .image-container img {
            display: block;
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        .exif-info {
            padding: 10px;
            font-size: 14px;
            color: #666;
            text-align: left;
            background-color: #f5f5f5;
            border-top: 1px solid #ddd;
        }

        .exif-info p {
            margin: 5px 0;
        }

        .exif-info p .label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>照片分享</h1>

    <div class="gallery"></div>

    <script src="exif.js"></script>
    <script>
        var startIndex = 0;
        var imagesPerLoad = 20;
        var scrollThreshold = 200;

        function loadImages(startIndex, count) {
            var gallery = document.querySelector('.gallery');

            for (var i = startIndex; i < startIndex + count; i++) {
                var imageContainer = document.createElement('div');
                imageContainer.className = 'image-container';

                var image = document.createElement('img');
                image.src = 'images/image' + i + '.jpg';
                imageContainer.appendChild(image);

                var exifInfo = document.createElement('div');
                exifInfo.className = 'exif-info';

                var exifHtml = '';
                var exifData = EXIF.getAllTags(image);
                if (exifData) {
                    if (exifData.DateTimeOriginal) {
                        var dateTaken = parseExifDateTime(exifData.DateTimeOriginal);
                        exifHtml += '<p class="exif-item"><span class="exif-label">拍摄时间:</span> ' + formatDate(dateTaken) + '</p>';
                    }
                    if (exifData.GPSLongitude && exifData.GPSLatitude) {
                        var longitude = formatCoordinates(exifData.GPSLongitude);
                        var latitude = formatCoordinates(exifData.GPSLatitude);
                        exifHtml += '<p class="exif-item"><span class="exif-label">经度:</span> ' + longitude + '</p>';
                        exifHtml += '<p class="exif-item"><span class="exif-label">纬度:</span> ' + latitude + '</p>';
                    }
                    if (exifData.FNumber) {
                        exifHtml += '<p class="exif-item"><span class="exif-label">光圈:</span> ' + exifData.FNumber + '</p>';
                    }
                    if (exifData.FocalLength) {
                        exifHtml += '<p class="exif-item"><span class="exif-label">焦距:</span> ' + exifData.FocalLength + '</p>';
                    }
                    if (exifData.Model) {
                        exifHtml += '<p class="exif-item"><span class="exif-label">相机型号:</span> ' + exifData.Model + '</p>';
                    }
                } else {
                    exifHtml = '<p>No Exif data available</p>';
                }

                exifInfo.innerHTML = exifHtml;
                imageContainer.appendChild(exifInfo);
                gallery.appendChild(imageContainer);
            }
        }

        function parseExifDateTime(dateTimeString) {
            var dateTimeParts = dateTimeString.split(' ');
            var dateParts = dateTimeParts[0].split(':');
            var timeParts = dateTimeParts[1].split(':');

            var year = parseInt(dateParts[0]);
            var month = parseInt(dateParts[1]) - 1;
            var day = parseInt(dateParts[2]);
            var hour = parseInt(timeParts[0]);
            var minute = parseInt(timeParts[1]);
            var second = parseInt(timeParts[2]);

            return new Date(year, month, day, hour, minute, second);
        }

        function formatDate(date) {
            var options = { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function formatCoordinates(coordinateArray) {
            var degrees = coordinateArray[0];
            var minutes = coordinateArray[1];
            var seconds = coordinateArray[2];

            var direction = coordinateArray[3];
            var coordinate = degrees + '° ' + minutes + "' " + seconds + '" ' + direction;

            return coordinate;
        }

        function sortImagesByExifDateTime() {
            var imageContainers = Array.from(document.querySelectorAll('.image-container'));

            imageContainers.sort(function(a, b) {
                var dateTimeA = parseExifDateTime(a.querySelector('.exif-info .exif-item:first-child span').textContent.replace('拍摄时间:', '').trim());
                var dateTimeB = parseExifDateTime(b.querySelector('.exif-info .exif-item:first-child span').textContent.replace('拍摄时间:', '').trim());

                return dateTimeB - dateTimeA;
            });

            var gallery = document.querySelector('.gallery');
            imageContainers.forEach(function(container) {
                gallery.appendChild(container);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadImages(startIndex, imagesPerLoad);
            sortImagesByExifDateTime();

            window.addEventListener('scroll', function() {
                var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                var windowHeight = window.innerHeight || document.documentElement.clientHeight;
                var documentHeight = document.documentElement.scrollHeight;

                if (documentHeight - scrollTop - windowHeight < scrollThreshold) {
                    startIndex += imagesPerLoad;
                    loadImages(startIndex, imagesPerLoad);
                    sortImagesByExifDateTime();
                }
            });
        });
    </script>
</body>
</html>
