<!DOCTYPE html>
<html>
<head>
    <title>照片分享</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            margin: 20px 0;
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }

        .image-container {
            width: 250px;
            margin: 10px;
        }

        .image {
            width: 100%;
            height: auto;
        }

        .exif-info {
            background-color: #f2f2f2;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .exif-info p {
            margin: 5px 0;
        }

        .exif-info .label {
            font-weight: bold;
        }

        /* 根据需要添加其他样式属性 */
    </style>
</head>
<body>
    <h1>照片分享</h1>

    <div class="gallery"></div>

    <script src="exif.js"></script>
    <script>
        var startIndex = 0;
        var imagesPerLoad = 20;
        var scrollThreshold = 200;

        function loadImages(startIndex, count) {
            var gallery = document.querySelector('.gallery');

            for (var i = startIndex; i < startIndex + count; i++) {
                var imageSrc = 'images/image' + i + '.jpg';

                var imageContainer = document.createElement('div');
                imageContainer.className = 'image-container';

                var imageElement = document.createElement('img');
                imageElement.src = imageSrc;
                imageElement.className = 'image';
                imageContainer.appendChild(imageElement);

                getExifInformation(imageElement, imageContainer);

                gallery.appendChild(imageContainer);
            }

            sortImagesByExifDateTime();
        }

        function getExifInformation(image, element) {
            EXIF.getData(image, function() {
                var exifInfo = document.createElement('div');
                exifInfo.className = 'exif-info';

                var exifData = EXIF.getAllTags(this);
                if (exifData) {
                    var exifHtml = '';

                    if (exifData.DateTimeOriginal) {
                        var dateTimeOriginal = exifData.DateTimeOriginal;
                        exifHtml += '<p><span class="label">拍摄时间:</span> ' + dateTimeOriginal + '</p>';
                    }

                    exifHtml += '<p><span class="label">经度:</span> ' + (exifData.GPSLongitude || 'N/A') + '</p>';
                    exifHtml += '<p><span class="label">纬度:</span> ' + (exifData.GPSLatitude || 'N/A') + '</p>';
                    exifHtml += '<p><span class="label">光圈:</span> ' + (exifData.FNumber || 'N/A') + '</p>';
                    exifHtml += '<p><span class="label">焦距:</span> ' + (exifData.FocalLength || 'N/A') + '</p>';
                    exifHtml += '<p><span class="label">相机型号:</span> ' + (exifData.Model || 'N/A') + '</p>';

                    exifInfo.innerHTML = exifHtml;
                } else {
                    exifInfo.textContent = '无可用的 EXIF 信息';
                }

                element.appendChild(exifInfo);
            });
        }

        function parseExifDateTime(dateTime) {
            var dateTimeParts = dateTime.split(' ');
            var dateParts = dateTimeParts[0].split(':');
            var timeParts = dateTimeParts[1].split(':');

            var year = parseInt(dateParts[0]);
            var month = parseInt(dateParts[1]) - 1;
            var day = parseInt(dateParts[2]);
            var hour = parseInt(timeParts[0]);
            var minute = parseInt(timeParts[1]);
            var second = parseInt(timeParts[2]);

            return new Date(year, month, day, hour, minute, second);
        }

        function sortImagesByExifDateTime() {
            var imageContainers = Array.from(document.querySelectorAll('.image-container'));

            imageContainers.sort(function(a, b) {
                var exifInfoA = a.querySelector('.exif-info');
                var exifInfoB = b.querySelector('.exif-info');

                var dateTimeA = parseExifDateTime(exifInfoA.querySelector('p:first-child').textContent.replace('拍摄时间:', '').trim());
                var dateTimeB = parseExifDateTime(exifInfoB.querySelector('p:first-child').textContent.replace('拍摄时间:', '').trim());

                return dateTimeB - dateTimeA;
            });

            var gallery = document.querySelector('.gallery');
            imageContainers.forEach(function(container) {
                gallery.appendChild(container);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadImages(startIndex, imagesPerLoad);

            window.addEventListener('scroll', function() {
                var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                var windowHeight = window.innerHeight || document.documentElement.clientHeight;
                var documentHeight = document.documentElement.scrollHeight;

                if (documentHeight - scrollTop - windowHeight < scrollThreshold) {
                    startIndex += imagesPerLoad;
                    loadImages(startIndex, imagesPerLoad);
                }
            });
        });
    </script>
</body>
</html>
