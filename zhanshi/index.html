<!DOCTYPE html>
<html>
<head>
    <title>照片展示</title>
    <meta charset="utf-8">
    <style>
        /* 图片容器的 CSS 样式 */
        .image-container {
            text-align: center;
            margin-bottom: 20px;
        }

        /* 图片的 CSS 样式 */
        .image-container img {
            max-width: 100%;
            height: auto;
        }

        /* exif 信息的 CSS 样式 */
        .exif-info {
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="gallery"></div>

    <script src="exif.js"></script>
    <script>
        var imagesFolder = 'images/'; // 存放照片的文件夹路径
        var imagesPerLoad = 20; // 每次滚动加载的照片数量
        var scrollThreshold = 200; // 滚动到页面底部触发加载更多照片的阈值

        var loadedImages = []; // 已加载的照片数组
        var loadedCount = 0; // 记录已加载的照片数量

        function loadImages() {
            // 加载初始的一组照片
            for (var i = 0; i < imagesPerLoad; i++) {
                var imageContainer = document.createElement('div');
                imageContainer.classList.add('image-container');

                var image = new Image();
                image.src = imagesFolder + 'image' + i + '.jpg';

                image.onload = function() {
                    var container = this.parentNode;
                    container.appendChild(this);
                    loadImageExif(this, container);
                };

                imageContainer.appendChild(image);
                loadedImages.push(imageContainer);
            }

            loadedCount += imagesPerLoad;
        }

        function shuffleArray(array) {
            // 使用 Fisher-Yates 算法打乱数组顺序的函数
            var currentIndex = array.length;
            var temporaryValue, randomIndex;

            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }

        function handleScroll() {
            // 处理滚动事件，当滚动到页面底部时加载更多的照片
            if (window.innerHeight + window.pageYOffset >= document.body.offsetHeight - scrollThreshold) {
                var remainingImages = loadedImages.slice(loadedCount);
                loadedImages = loadedImages.slice(0, loadedCount);

                shuffleArray(remainingImages);

                remainingImages.forEach(function(imageContainer) {
                    var gallery = document.querySelector('.gallery');
                    gallery.appendChild(imageContainer);
                });

                loadedCount += remainingImages.length;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadImages();
            window.addEventListener('scroll', handleScroll);
        });

        function loadImageExif(image, container) {
            // 加载并显示照片的 exif 信息
            EXIF.getData(image, function() {
                var exifInfo = document.createElement('div');
                exifInfo.classList.add('exif-info');

                var exifData = EXIF.pretty(this);

                if (exifData) {
                    exifInfo.textContent = exifData;
                } else {
                    exifInfo.textContent = '无可用的 EXIF 信息';
                }

                container.appendChild(exifInfo);
            });
        }
    </script>
</body>
</html>
